import CommandDemo from './jsx/api/Command.js';

# Command

Command is the base class for all regl-based drawing commands. Subclasses should override getDrawProps and (and optionally mapObjectToInstanceCount). Note: mapObjectToInstanceCount is not implemented in this base class.

##### Properties generally implemented by wrapping classes

| Name                        | optional | type                                                                   | Default | Description                                                                                         |
| --------------------------- | -------- | ---------------------------------------------------------------------- | ------- | --------------------------------------------------------------------------------------------------- |
| `reglCommand`               | no       | `(Regl) => (Props) => void`                                       |         | The command that takes the `regl` function and drawProps and draws the shape                        |
| `mapObjectToInstanceCount`  | yes      | `(T) => number`                                                       |         | map the marker object to the number of instances it has. See Mouse Events for more |
| `mapDrawObjectToHitmapObject` | yes    | `(T, number) => ?T`                                               |         | map the marker object to an object that should be used instead when rendering to the hitmap for detecting mouse events. See Mouse Events for more |

##### Properties generally passed through wrapping classes

| Name                        | optional | type                                                                   | Default | Description                                                                                         |
| --------------------------- | -------- | ---------------------------------------------------------------------- | ------- | --------------------------------------------------------------------------------------------------- |
| `drawProps`                 | no       | `Array<any> | any`                                                     |         | Arbitrary properties passed into reglCommand.                |
| `layerIndex`                | yes      | `number`                                                               |         | defines the draw order of each command, e.g. -1 will put the shape in lower layer                   |
| `interactive`               | yes      | `boolean`                                                            |         | marks the layer as one that emits events.                    |

Sample usage:

```js
import Worldview, { withPose, Command } from "regl-worldview";

// define our regl command
const reglTriangle = (regl) => ({
  vert: `
    precision mediump float;
    attribute vec2 position;
    void main () {
      gl_Position = vec4(position, 0, 1);
    }
  `,
  frag: `
    precision mediump float;
    uniform vec4 color;
    void main () {
      gl_FragColor = color;
  }`,
  attributes: {
    position: regl.prop("points"),
  },
  uniforms: {
    color: regl.prop("color"),
  },
  count: regl.prop("points.length"),
});

// define a Triangle React component to render with our regl command
function Triangle({ color }) {
  const drawProps = {
    color,
    points: [[-1, 0], [0, -1], [1, 1]],
  };
  return <Command reglCommand={reglTriangle} drawProps={drawProps} />;
}

// pass our Triangle component to worldview
function CommandDemo() {
  return (
    <div style={{ height: 500 }}>
      <Worldview>
        <Triangle color={[0, 0, 1, 1]} />
      </Worldview>
    </div>
  );
}
```

<CommandDemo />

## makeCommand

When you have children as the drawProps input, it's useful to simply call makeCommand which creates a regl component automatically based on the regl command supplied. You'll want to return a `<Command />` component directly from render if the React children is not the drawProps input or if additional data processing is needed to generate the drawProps.

Sample usage:

```js
const Cubes = makeCommand("Cubes", rawReglCommand);

// example for supporting interactions for instanced objects, for details check the MouseEvents documentation
const Cubes = makeCommand("Cubes", rawReglCommand, {
  mapObjectToInstanceCount: () => {...},
});
```
