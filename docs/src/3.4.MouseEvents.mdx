import { MouseEvents, MouseEventsInstanced } from './jsx/allLiveEditors';

# MouseEvents

Currently Worldview supports the following mouse event handlers: `onDoubleClick`, `onMouseDown`, `onMouseUp`, `onMouseMove`, and `onClick`. When a supported DOM event is fired, the event handler will be triggered with the original event object and additional event information which can help build interactive views.

| Name            | type           | Default | Description                                                                                  |
| --------------- | -------------- | ------- | -------------------------------------------------------------------------------------------- |
| `onDoubleClick` | `MouseHandler` |         |                                                                                              |
| `onMouseDown`   | `MouseHandler` |         |                                                                                              |
| `onMouseUp`     | `MouseHandler` |         |                                                                                              |
| `onMouseMove`   | `MouseHandler` |         | only available if the `hitmapOnMouseMove` prop is set to `true` on the Worldview component |
| `onClick`       | `MouseHandler` |         |                                                                                              |

## Event Handler

There are two kinds of event handlers:

**Worldview Level Handlers**

- `ray`: the raw raycasting information including `dir` (direction), `origin`, and `point` (all in `Vec3` format).
- `object`: the the object that you interacted with. The value is `undefined` if no object is found.

**Command Component Level Handlers**

- `ray`: the raw raycasting information including `dir` (direction), `origin`, and `point` (all in `Vec3` format).
- `object`: the object that you interacted with.

```js
<Worldview onClick={(evt, { object }) => console.log("You clicked on", object && object.id)}>
  <Cubes onClick={(evt, { object }) => console.log("You clicked on", object && object.id)}>{cubes}</Cubes>
  {/* Other command children */}
</Worldview>
```

### Mouse events for instanced objects

Usually using instanced objects can help improve rendering performance, e.g. an instanced sphere can contain thousands of spheres. When the user clicks a single sphere, the object and instance index which was generated will be returned from the event.

_Commands that currently support instanced rendering: Cubes, Points, Spheres, Triangles, Cones, Cylinders. More to be added later._

##### Figuring out which instance was clicked on

Commands can optionally implement the `mapObjectToInstanceCount` function. Implementing this function indicates to the Worldview events system that the command has different instances that can be interacted with. The command takes the object to render and returns the number of instances in that object.

Example:

```js
<Worldview>
  <Cubes
    onClick={(evt, { object, instanceIndex }) => console.log(`You clicked on ${object.id} at index ${instanceIndex}`)}
    mapObjectToInstanceCount={(cube) => cube.points.length}
  >
    {cubes}
  </Cubes>
</Worldview>
```

##### Interacting with an object in a different way than how it is rendered

Some commands may want to do something special when the user interacts with them. For example, a Point instance may want to allow clicking close to a point and not directly on a point to still trigger a click event. `mapDrawPropToHitmapProp` allows this by taking in the object to be rendered and returning a new object that will be rendered into the hitmap only.

Example:

```js
<Worldview>
  <Points
    onClick={(evt, { object }) => console.log(`You clicked on ${object.id}`)}
    mapDrawPropToHitmapProp={(prop, index) => {
      // Only allow interaction with every second object
      if (index % 2) {
        return null;
      }
      // Scale the points up, assuming the default scale is 1,1,1
      return { ...prop, scale: { x: 1.2, y: 1.2, z: 1.2 } };
    }}
  >
    {points}
  </Points>
</Worldview>
```

### Instanced/regular rendering example

<MouseEventsInstanced />

## Full Example

<MouseEvents />

## Other

`onClick` events don't fire if the user moves the cursor for more than 3 screen pixels between mouse down and mouse up. This ensures that dragging the mouse to pan the Worldview camera doesn't also trigger an `onClick` event.
